# Maintainer: William Turner <willtur.will@gmail.com>

_pkgname=wsl-vpnkit
pkgname="${_pkgname}-bin"
# renovate: datasource=github-releases depName=sakai135/wsl-vpnkit
pkgver=0.8.7
pkgrel=1
pkgdesc='Provides network connectivity to WSL 2 when blocked by VPN'
arch=('x86_64')
url='https://github.com/sakai135/wsl-vpnkit'
license=('Apache-2.0')
depends=('iproute2'
         'iptables')
provides=("${_pkgname}")
conflicts=("${_pkgname}")
source=("https://github.com/containers/gvisor-tap-vsock/releases/download/v${pkgver}/"{gvforwarder,gvproxy-windows.exe}
        "https://github.com/containers/gvisor-tap-vsock/raw/refs/tags/v${pkgver}/LICENSE"
        80-wsltap.network
        wsl-vpnkit.service
        wsl-vpnkit-fw)
sha256sums=('7e3ba80c2cc0e8f397ac40715d4e190c3b6f3ffee6ed61293689e96346d507f1'
            'fd1168f36225595001d6cf4eac2a40368cb29bbd151a77a6d0c63a7f61bed357'
            'cfc7749b96f63bd31c3c42b5c471bf756814053e847c10f3eb003417bc523d30'
            '2dbcf00888c7606c1fcd26fff84db2df5aca64c77f0c61f743951c3fb59b1027'
            '613ef62cb1e9989ab93af7933719749c5aa3fbaa877efa49b64a9c7d7866c46b'
            'e0b5fd1c260d66f8b4adc7aa190238174c2b7fbc0cf8cc6f770905d7cb852808')

package() {
  install -D -m0755 gvproxy-windows.exe "${pkgdir}/usr/lib/wsl-vpnkit/wsl-gvproxy.exe"
  install -D -m0755 gvforwarder "${pkgdir}/usr/lib/wsl-vpnkit/wsl-gvforwarder"

  install -D -m0755 wsl-vpnkit-fw "${pkgdir}/usr/lib/wsl-vpnkit/wsl-vpnkit-fw"

  install -D -m0644 80-wsltap.network "${pkgdir}/usr/lib/systemd/network/80-wsltap.network"
  install -D -m0644 wsl-vpnkit.service "${pkgdir}/usr/lib/systemd/system/wsl-vpnkit.service"

  install -D -m0644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
